openapi: 3.0.3
info:
  title: AI-Powered Todo Chatbot API
  description: Backend API endpoints for the chatbot feature that enables natural language task management
  version: 1.0.0
  contact:
    name: Phase III - AI Chatbot Feature

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://api.example.com
    description: Production server (Phase V)

tags:
  - name: chatbot
    description: Chatbot conversation endpoints

paths:
  /api/chatbot/message:
    post:
      tags:
        - chatbot
      summary: Send a message to the chatbot
      description: |
        Process a user message, parse intent, execute task operations, and return a conversational response.
        This is the primary endpoint for chatbot interaction.
      operationId: sendMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageRequest'
            examples:
              createTask:
                summary: Create a new task
                value:
                  session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                  message: "add a task to buy groceries"
              completeTask:
                summary: Complete an existing task
                value:
                  session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                  message: "mark buy groceries as done"
              queryTasks:
                summary: Query tasks
                value:
                  session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                  message: "what tasks do I have?"
      responses:
        '200':
          description: Message processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              examples:
                taskCreated:
                  summary: Task created successfully
                  value:
                    message_id: "550e8400-e29b-41d4-a716-446655440000"
                    session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                    response: "I've added 'buy groceries' to your task list."
                    intent:
                      action: "CREATE"
                      confidence: 0.95
                      task_title: "buy groceries"
                      ambiguous: false
                    timestamp: "2026-02-15T14:30:00Z"
                clarificationNeeded:
                  summary: Ambiguous intent requiring clarification
                  value:
                    message_id: "550e8400-e29b-41d4-a716-446655440001"
                    session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                    response: "I found multiple tasks with 'report' in the title. Which one did you mean?"
                    intent:
                      action: "COMPLETE"
                      confidence: 0.45
                      ambiguous: true
                      clarification_needed: "Which task would you like to complete?"
                    timestamp: "2026-02-15T14:31:00Z"
        '400':
          description: Invalid request (empty message, invalid session_id)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid request"
                message: "Message content cannot be empty"
                timestamp: "2026-02-15T14:30:00Z"
        '404':
          description: Session not found or expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Session not found"
                message: "The session has expired or does not exist. Please start a new conversation."
                timestamp: "2026-02-15T14:30:00Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Internal server error"
                message: "An unexpected error occurred. Please try again."
                timestamp: "2026-02-15T14:30:00Z"

  /api/chatbot/session:
    get:
      tags:
        - chatbot
      summary: Get current session information
      description: Retrieve session metadata and message history for the current conversation
      operationId: getSession
      parameters:
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Unique session identifier
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
      responses:
        '200':
          description: Session retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
              example:
                session_id: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
                message_count: 6
                created_at: "2026-02-15T14:00:00Z"
                last_activity: "2026-02-15T14:30:00Z"
                expires_at: "2026-02-15T15:00:00Z"
                messages:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    sender: "user"
                    content: "add a task to buy groceries"
                    timestamp: "2026-02-15T14:00:00Z"
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    sender: "bot"
                    content: "I've added 'buy groceries' to your task list."
                    timestamp: "2026-02-15T14:00:05Z"
        '404':
          description: Session not found or expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - chatbot
      summary: Clear session and conversation history
      description: Delete the session and all associated messages. User will need to start a new conversation.
      operationId: deleteSession
      parameters:
        - name: session_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Unique session identifier
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
      responses:
        '204':
          description: Session deleted successfully (no content)
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    MessageRequest:
      type: object
      required:
        - message
      properties:
        session_id:
          type: string
          format: uuid
          description: Session identifier. If not provided, a new session will be created.
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        message:
          type: string
          minLength: 1
          maxLength: 2000
          description: User's natural language message
          example: "add a task to buy groceries"

    MessageResponse:
      type: object
      required:
        - message_id
        - session_id
        - response
        - timestamp
      properties:
        message_id:
          type: string
          format: uuid
          description: Unique identifier for this message
          example: "550e8400-e29b-41d4-a716-446655440000"
        session_id:
          type: string
          format: uuid
          description: Session identifier
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        response:
          type: string
          description: Chatbot's conversational response
          example: "I've added 'buy groceries' to your task list."
        intent:
          $ref: '#/components/schemas/Intent'
        timestamp:
          type: string
          format: date-time
          description: Response timestamp (ISO 8601)
          example: "2026-02-15T14:30:00Z"

    Intent:
      type: object
      required:
        - action
        - confidence
        - ambiguous
      properties:
        action:
          type: string
          enum: [CREATE, READ, UPDATE, DELETE, COMPLETE]
          description: Parsed intent action type
          example: "CREATE"
        confidence:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Intent parsing confidence score
          example: 0.95
        task_id:
          type: integer
          nullable: true
          description: Target task ID (for UPDATE, DELETE, COMPLETE)
          example: 42
        task_title:
          type: string
          nullable: true
          minLength: 1
          maxLength: 200
          description: Task title (for CREATE, UPDATE)
          example: "buy groceries"
        task_description:
          type: string
          nullable: true
          maxLength: 1000
          description: Task description (for CREATE, UPDATE)
          example: "Get milk, eggs, and bread from the store"
        query_filter:
          type: object
          nullable: true
          description: Query parameters (for READ)
          additionalProperties: true
          example:
            is_completed: false
        ambiguous:
          type: boolean
          description: Whether the intent is ambiguous and requires clarification
          example: false
        clarification_needed:
          type: string
          nullable: true
          maxLength: 500
          description: Clarification question if intent is ambiguous
          example: "Which task would you like to complete?"

    SessionResponse:
      type: object
      required:
        - session_id
        - message_count
        - created_at
        - last_activity
        - expires_at
        - messages
      properties:
        session_id:
          type: string
          format: uuid
          description: Unique session identifier
          example: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        message_count:
          type: integer
          description: Total number of messages in the session
          example: 6
        created_at:
          type: string
          format: date-time
          description: Session creation timestamp (ISO 8601)
          example: "2026-02-15T14:00:00Z"
        last_activity:
          type: string
          format: date-time
          description: Last message timestamp (ISO 8601)
          example: "2026-02-15T14:30:00Z"
        expires_at:
          type: string
          format: date-time
          description: Session expiry timestamp (ISO 8601)
          example: "2026-02-15T15:00:00Z"
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessage'
          description: Ordered list of messages in the conversation

    ChatMessage:
      type: object
      required:
        - id
        - sender
        - content
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Unique message identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        sender:
          type: string
          enum: [user, bot]
          description: Message sender
          example: "user"
        content:
          type: string
          minLength: 1
          maxLength: 2000
          description: Message text content
          example: "add a task to buy groceries"
        timestamp:
          type: string
          format: date-time
          description: Message timestamp (ISO 8601)
          example: "2026-02-15T14:30:00Z"
        intent:
          $ref: '#/components/schemas/Intent'
          nullable: true
          description: Parsed intent (bot messages only)

    ErrorResponse:
      type: object
      required:
        - error
        - message
        - timestamp
      properties:
        error:
          type: string
          description: Error type
          example: "Invalid request"
        message:
          type: string
          description: Human-readable error message
          example: "Message content cannot be empty"
        timestamp:
          type: string
          format: date-time
          description: Error timestamp (ISO 8601)
          example: "2026-02-15T14:30:00Z"
        details:
          type: object
          nullable: true
          description: Additional error details
          additionalProperties: true

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: JWT token authentication (Phase V - not implemented in Phase III)

security: []  # No authentication in Phase III (single-user local development)
