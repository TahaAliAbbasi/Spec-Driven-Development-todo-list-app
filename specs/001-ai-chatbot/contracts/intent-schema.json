{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/intent.json",
  "title": "Intent Schema",
  "description": "JSON schema for chatbot intent parsing output. Defines the structure of parsed user intents for task management operations.",
  "type": "object",
  "required": ["action", "confidence", "ambiguous"],
  "properties": {
    "action": {
      "type": "string",
      "enum": ["CREATE", "READ", "UPDATE", "DELETE", "COMPLETE"],
      "description": "The type of task operation the user intends to perform",
      "examples": ["CREATE", "COMPLETE", "READ"]
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence score of the intent parsing (0.0 = no confidence, 1.0 = absolute confidence)",
      "examples": [0.95, 0.88, 0.45]
    },
    "task_id": {
      "type": ["integer", "null"],
      "minimum": 1,
      "description": "Target task ID for UPDATE, DELETE, or COMPLETE operations. Null if task is identified by title.",
      "examples": [42, 123, null]
    },
    "task_title": {
      "type": ["string", "null"],
      "minLength": 1,
      "maxLength": 200,
      "description": "Task title for CREATE operations or task identifier for UPDATE/DELETE/COMPLETE operations",
      "examples": ["buy groceries", "finish the report", null]
    },
    "task_description": {
      "type": ["string", "null"],
      "maxLength": 1000,
      "description": "Task description for CREATE or UPDATE operations",
      "examples": ["Get milk, eggs, and bread from the store", null]
    },
    "query_filter": {
      "type": ["object", "null"],
      "description": "Query parameters for READ operations to filter tasks",
      "properties": {
        "is_completed": {
          "type": "boolean",
          "description": "Filter by completion status"
        },
        "search_term": {
          "type": "string",
          "description": "Search term to match against task titles"
        }
      },
      "additionalProperties": true,
      "examples": [
        {"is_completed": false},
        {"search_term": "groceries"},
        null
      ]
    },
    "ambiguous": {
      "type": "boolean",
      "description": "Whether the intent is ambiguous and requires clarification from the user",
      "examples": [false, true]
    },
    "clarification_needed": {
      "type": ["string", "null"],
      "maxLength": 500,
      "description": "Clarification question to ask the user if intent is ambiguous",
      "examples": [
        "Which task would you like to complete?",
        "I found multiple tasks with 'report' in the title. Which one did you mean?",
        null
      ]
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "action": {"const": "CREATE"}
        }
      },
      "then": {
        "required": ["task_title"],
        "properties": {
          "task_title": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "action": {"enum": ["UPDATE", "DELETE", "COMPLETE"]}
        }
      },
      "then": {
        "anyOf": [
          {"required": ["task_id"]},
          {"required": ["task_title"]}
        ]
      }
    },
    {
      "if": {
        "properties": {
          "ambiguous": {"const": true}
        }
      },
      "then": {
        "required": ["clarification_needed"],
        "properties": {
          "clarification_needed": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    }
  ],
  "examples": [
    {
      "action": "CREATE",
      "confidence": 0.95,
      "task_id": null,
      "task_title": "buy groceries",
      "task_description": null,
      "query_filter": null,
      "ambiguous": false,
      "clarification_needed": null
    },
    {
      "action": "COMPLETE",
      "confidence": 0.88,
      "task_id": null,
      "task_title": "buy groceries",
      "task_description": null,
      "query_filter": null,
      "ambiguous": false,
      "clarification_needed": null
    },
    {
      "action": "READ",
      "confidence": 0.92,
      "task_id": null,
      "task_title": null,
      "task_description": null,
      "query_filter": {
        "is_completed": false
      },
      "ambiguous": false,
      "clarification_needed": null
    },
    {
      "action": "UPDATE",
      "confidence": 0.45,
      "task_id": null,
      "task_title": null,
      "task_description": null,
      "query_filter": null,
      "ambiguous": true,
      "clarification_needed": "Which task would you like to update?"
    },
    {
      "action": "DELETE",
      "confidence": 0.87,
      "task_id": 42,
      "task_title": null,
      "task_description": null,
      "query_filter": null,
      "ambiguous": false,
      "clarification_needed": null
    }
  ]
}
